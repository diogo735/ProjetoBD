<div class="container py-4">

    <!-- Tabs para Lista de Matrículas -->
    <ul class="nav nav-tabs" id="matriculaTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="matricula-lista-tab" data-bs-toggle="tab" data-bs-target="#matricula-lista" type="button" role="tab" aria-controls="matricula-lista" aria-selected="true">
                Lista de Matrículas
            </button>
        </li>
    </ul>

    <div class="tab-content mt-4" id="matriculaTabContent">
        <!-- Tab Lista de Matrículas -->
        <div class="tab-pane fade show active" id="matricula-lista" role="tabpanel" aria-labelledby="matricula-lista-tab">
            <div class="card shadow">
                <div class="card-header bg-light">
                    <h2 class="h5 mb-0">Matrículas dos Alunos</h2>
                </div>
                <div class="card-body">
                    <p>Listagem de todas as matrículas registradas na Universidade.</p>

                    <!-- Tabela de Matrículas -->
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>ID Matrícula</th>
                                    <th>Nome do Aluno</th>
                                    <th>Curso</th>
                                    <th>Ano Letivo</th>
                                    <th>Data da Matrícula</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if todas_matriculas %}
                                    {% for matricula in todas_matriculas %}
                                    <tr>
                                        <td>{{ matricula.id_matricula }}</td>
                                        <td>{{ matricula.nome_aluno }}</td>
                                        <td>{{ matricula.nome_curso }}</td>
                                        <td>{{ matricula.ano_letivo }}</td>
                                        <td>{{ matricula.data_matricula }}</td>
                                        <td>
                                            <!-- Botão Ver Detalhes -->
                                            <button type="button" class="btn btn-sm btn-primary" onclick="carregarDetalhes('{{ matricula.id_matricula }}')" data-bs-toggle="modal" data-bs-target="#detalhesModal">
                                                Ver Detalhes
                                            </button>

                                            <!-- Botão Remover -->
                                            <button type="button" class="btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target="#removerModal-{{ matricula.id_matricula }}">
                                                Remover
                                            </button>

                                            <!-- Modal Remover -->
                                            <div class="modal fade" id="removerModal-{{ matricula.id_matricula }}" tabindex="-1" aria-labelledby="removerModalLabel-{{ matricula.id_matricula }}" aria-hidden="true">
                                                <div class="modal-dialog">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h5 class="modal-title" id="removerModalLabel-{{ matricula.id_matricula }}">Confirmar Remoção</h5>
                                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                        </div>
                                                        <div class="modal-body">
                                                            <p>Tem certeza que deseja remover a matrícula de <strong>{{ matricula.nome_aluno }}</strong>?</p>
                                                        </div>
                                                        <div class="modal-footer d-flex justify-content-end gap-2">
                                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                                            <form method="POST" action="{% url 'funcionario_delete_matricula' matricula.id_matricula %}">
                                                                {% csrf_token %}
                                                                <button type="submit" class="btn btn-danger">Remover</button>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                        </td>
                                    </tr>
                                    {% endfor %}
                                {% else %}
                                    <tr>
                                        <td colspan="6" class="text-center">Nenhuma matrícula encontrada.</td>
                                    </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal Detalhes da Matrícula -->
<div class="modal fade" id="detalhesModal" tabindex="-1" aria-labelledby="detalhesModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="detalhesModalLabel">Detalhes da Matrícula</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p><strong>Curso:</strong> <span id="detalhesCurso"></span></p>
                <p><strong>Ano Letivo:</strong> <span id="detalhesAno"></span></p>
                <p><strong>Data da Matrícula:</strong> <span id="detalhesData"></span></p>

                <h5 class="mt-3">Unidades Curriculares e Turnos</h5>
                <ul class="list-group" id="detalhesUCs">
                    <!-- As UCs e turnos serão carregados dinamicamente aqui -->
                </ul>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            </div>
        </div>
    </div>
</div>

<script>
    function carregarDetalhes(idMatricula) {
        fetch(`/funcionario/matricula/detalhes/${idMatricula}/`)
            .then(response => response.json())
            .then(data => {
                document.getElementById("detalhesCurso").textContent = data.curso;
                document.getElementById("detalhesAno").textContent = data.ano_letivo;
                document.getElementById("detalhesData").textContent = data.data_matricula;

                let ucList = document.getElementById("detalhesUCs");
                ucList.innerHTML = "";
                data.ucs.forEach(uc => {
                    let li = document.createElement("li");
                    li.className = "list-group-item";
                    li.innerHTML = `<strong>${uc.unidade_curricular}</strong> - Turno: ${uc.turno}`;
                    ucList.appendChild(li);
                });
            })
            .catch(error => console.error("Erro ao carregar os detalhes da matrícula:", error));
    }
</script>
