{% load static %}

<div class="container py-4">

    <!-- Tabs para Detalhes e Turno -->
    <ul class="nav nav-tabs" id="horariosTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="detalhes-tab" data-bs-toggle="tab" data-bs-target="#detalhes"
                type="button" role="tab" aria-controls="detalhes" aria-selected="true">
                Detalhes
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="turno-tab" data-bs-toggle="tab" data-bs-target="#turno" type="button"
                role="tab" aria-controls="turno" aria-selected="false">
                Turnos
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="horarios-tab" data-bs-toggle="tab" data-bs-target="#horario" type="button"
                role="tab" aria-controls="horario" aria-selected="false">
                Hor√°rios
            </button>
        </li>
    </ul>

    <div class="tab-content mt-4" id="horariosTabContent">
        <!-- Tab Detalhes -->
        <div class="tab-pane fade show active" id="detalhes" role="tabpanel" aria-labelledby="detalhes-tab">
            <div class="card shadow">
                <div class="card-header bg-light">
                    <h2 class="h5 mb-0">Turnos do Ano Letivo Atual - 2024/2025</h2>
                </div>
                <div class="card-body">
                    <p>Consulte os hor√°rios dos turnos por curso, ano e semestre para o ano letivo atual.</p>
                    <div style="max-height: 400px; overflow-y: auto;">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Curso</th>
                                    <th>Turno</th>
                                    <th>Ano</th>
                                    <th>Semestre</th>
                                    <th>Vagas Dispon√≠veis</th>
                                    <th>Hor√°rio</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for turno in turnos %}
                                <tr>
                                    <td>{{ turno.curso }}</td>
                                    <td>{{ turno.nome_turno }}</td>
                                    <td>{{ turno.ano }}</td>
                                    <td>{{ turno.semestre }}</td>
                                    <td>{{ turno.vagas_totais }}</td>
                                    <td>
                                        <button type="button" class="btn btn-primary btn-sm"
                                            data-turno-nome="{{ turno.nome_turno }}"
                                            data-semestre="{{ turno.semestre }}" data-ano="{{ turno.ano }}"
                                            data-curso="{{ turno.curso }}" data-bs-toggle="modal"
                                            data-bs-target="#horarioModal" onclick="carregarHorariosComData(this)">
                                            Ver Hor√°rio
                                        </button>


                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="6">Nenhum turno dispon√≠vel no momento.</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Turno -->
        <div class="tab-pane fade" id="turno" role="tabpanel" aria-labelledby="turno-tab">
            <div class="card shadow">
                <div class="card-header bg-light d-flex justify-content-between align-items-center">
                    <h2 class="h5 mb-0">Configura√ß√µes de Turnos</h2>
                    <button type="button" class="btn btn-success btn-sm" data-bs-toggle="modal"
                        data-bs-target="#criarTurnoModal">
                        <i class="bi bi-plus"></i> Criar Turno
                    </button>
                </div>
                <div class="card-body">
                    <p>Pesquise por curso,ano e semestre para realizar ou alterar turnos.</p>
                    <form class="row g-3">
                        <div class="col-md-6">
                            <label for="cursoPesquisa" class="form-label">Curso</label>
                            <select id="cursoPesquisa" class="form-select" required>
                                <option selected disabled>Escolha o curso...</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="ano" class="form-label">Ano</label>
                            <select id="ano" class="form-select" required>
                                <option selected disabled>Escolha o ano...</option>
                                <option value="1">1¬∫ Ano</option>
                                <option value="2">2¬∫ Ano</option>
                                <option value="3">3¬∫ Ano</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="semestre" class="form-label">Semestre</label>
                            <select id="semestre" class="form-select" required>
                                <option selected disabled>Escolha o semestre...</option>
                                <option value="1">1¬∫ Semestre</option>
                                <option value="2">2¬∫ Semestre</option>
                            </select>
                        </div>
                        <div class="col-12 mt-3">
                            <button type="button" class="btn btn-outline-primary" onclick="pesquisarDados()"> <i
                                    class="bi bi-search"></i> Pesquisar Turno</button>
                        </div>
                    </form>

                    <div class="mt-4">
                        <div class="d-flex justify-content-between align-items-center">
                            <h3 class="h6 mb-0">Resultados Dispon√≠veis: <span id="quantidadeResultados"></span></h3>
                        </div>
                        <div style="height: 23vh; overflow-y: auto;">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Turno</th>
                                        <th>Vagas Restantes</th>
                                        <th>Vagas Totais</th>
                                        <th>Estado</th>
                                        <th>A√ß√µes</th>
                                    </tr>
                                </thead>
                                <div id="loadingSpinner" class="text-center my-3" style="display: none;">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Carregando...</span>
                                    </div>
                                </div>
                                <tbody id="resultadosDisponiveis">
                                    <!-- Resultados dos turnos ir√£o aparecer aqui -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Hor√°rios -->
        <div class="tab-pane fade" id="horario" role="tabpanel" aria-labelledby="horarios-tab">
            <div class="card shadow">
                <div class="card-header bg-light d-flex justify-content-between align-items-center">
                    <h2 class="h5 mb-0">Gerenciamento de Hor√°rios</h2>
                    <button type="button" class="btn btn-success btn-sm" data-bs-toggle="modal"
                        data-bs-target="#criarHorarioModal">
                        <i class="bi bi-plus"></i> Adicionar Hor√°rio
                    </button>
                </div>
                <div class="card-body">
                    <p>Pesquisar hor√°rios dos turnos</p>
                    <form class="row g-3">
                        <div class="col-md-6">
                            <label for="cursoPesquisa_horarios" class="form-label">Curso</label>
                            <select id="cursoPesquisa_horarios" class="form-select" required>
                                <option selected disabled>Escolha o curso...</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="ano_horario" class="form-label">Ano</label>
                            <select id="ano_horario" class="form-select" required>
                                <option selected disabled>Escolha o ano...</option>
                                <option value="1¬∫ Ano">1¬∫ Ano</option>
                                <option value="2¬∫ Ano">2¬∫ Ano</option>
                                <option value="3¬∫ Ano">3¬∫ Ano</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="semestre_horario" class="form-label">Semestre</label>
                            <select id="semestre_horario" class="form-select" required>
                                <option selected disabled>Escolha o semestre...</option>
                                <option value="1¬∫ Semestre">1¬∫ Semestre</option>
                                <option value="2¬∫ Semestre">2¬∫ Semestre</option>
                            </select>
                        </div>
                        <div class="col-12 mt-3">
                            <button type="button" class="btn btn-outline-primary" onclick="pesquisarHorarios()">
                                <i class="bi bi-search"></i> Pesquisar Hor√°rio
                            </button>
                        </div>
                    </form>

                    <div class="mt-4">
                        <div class="d-flex justify-content-between align-items-center">
                            <h3 class="h6 mb-0">Resultados Dispon√≠veis: <span id="quantidadeResultados"></span></h3>
                        </div>
                        <div style="height: 23vh; overflow-y: auto;">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Turno</th>
                                        <th>Curso</th>
                                        <th>Ano</th>
                                        <th>Semestre</th>
                                        <th>A√ß√µes</th>
                                    </tr>
                                </thead>
                                <div id="loadingSpinner" class="text-center my-3" style="display: none;">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Carregando...</span>
                                    </div>
                                </div>
                                <tbody id="resultadosDisponiveis_horarios">
                                    <!-- Resultados dos hor√°rios ir√£o aparecer aqui -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>



        <!-- Modal para Ver Hor√°rio -->
        <div class="modal fade" id="horarioModal" tabindex="-1" aria-labelledby="horarioModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg" style="max-width: 80%; margin: 5vh auto;">
                <div class="modal-content" style="max-height: 90vh; overflow: hidden;">
                    <div class="modal-header">
                        <h5 class="modal-title" id="horarioModalLabel">Hor√°rios do Turno</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" style="max-height: calc(90vh - 60px); overflow-y: auto;">
                        <table class="table table-bordered" style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr>
                                    <th>Hora</th>
                                    <th>Segunda-feira</th>
                                    <th>Ter√ßa-feira</th>
                                    <th>Quarta-feira</th>
                                    <th>Quinta-feira</th>
                                    <th>Sexta-feira</th>
                                </tr>
                            </thead>
                            <tbody id="horariosTableBody">
                                <!-- Os hor√°rios ser√£o gerados dinamicamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>


        <!-- Modal para Criar Turno -->
        <div class="modal fade" id="criarTurnoModal" tabindex="-1" aria-labelledby="criarTurnoModalLabel"
            aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="criarTurnoModalLabel">Criar Novo Turno</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="formCriarTurno" onsubmit="event.preventDefault(); enviarFormularioCriarTurno();">
                            <div class="mb-3">
                                <label for="nomeTurno" class="form-label">Nome do Turno</label>
                                <div class="input-group">
                                    <select class="form-select" id="selectNomeTurno">
                                        <option selected disabled>Escolha um turno existente...</option>
                                    </select>
                                    <input type="text" class="form-control" id="inputNomeTurno"
                                        placeholder="Ou digite um novo nome">
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="vagasTurno" class="form-label">N√∫mero de Vagas</label>
                                <input type="number" class="form-control" id="vagasTurno"
                                    placeholder="Digite o n√∫mero de vagas" required>
                            </div>
                            <div class="mb-3">
                                <label for="cursoTurno" class="form-label">Curso</label>
                                <select class="form-select" id="cursoTurno" required>
                                    <option selected disabled>Escolha o curso...</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="anoTurno" class="form-label">Ano</label>
                                <select class="form-select" id="anoTurno" required>
                                    <option selected disabled>Escolha o ano...</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="semestreTurno" class="form-label">Semestre</label>
                                <select class="form-select" id="semestreTurno" required>
                                    <option selected disabled>Escolha o semestre...</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="ucTurno" class="form-label">Unidade Curricular (UC)</label>
                                <select class="form-select" id="ucTurno" required>
                                    <option selected disabled>Selecione Curso, Ano e Semestre</option>
                                </select>
                            </div>
                            <div class="modal-footer">
                                <button type="submit" class="btn btn-primary"><i
                                        class="bi bi-save me-2"></i>Guardar</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>




        <!-- Modal Editar Turno -->
        <div class="modal fade" id="editarTurnoModal" tabindex="-1" aria-labelledby="editarTurnoLabel"
            aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editarTurnoLabel">Editar Turno</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                    </div>
                    <div class="modal-body">
                        <form id="formEditarTurno">
                            <input type="hidden" id="editTurnoId">
                            <div class="mb-3">
                                <label for="editarNomeTurno" class="form-label">Nome do Turno</label>
                                <input type="text" class="form-control" id="editarNomeTurno" required>
                            </div>
                            <div class="mb-3">
                                <label for="editarVagasTotais" class="form-label">N√∫mero de Vagas Totais</label>
                                <input type="number" class="form-control" id="editarVagasTotais"
                                    placeholder="Digite o n√∫mero de vagas totais" required>
                            </div>
                            <div class="mb-3">
                                <p id="vagasOcupadasTexto">Vagas ocupadas: <strong>--</strong></p>
                            </div>

                            <div class="mb-3">
                                <label for="editarAnoTurno" class="form-label">Ano</label>
                                <select id="editarAnoTurno" class="form-select">
                                    <option value="1">1¬∫ Ano</option>
                                    <option value="2">2¬∫ Ano</option>
                                    <option value="3">3¬∫ Ano</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="editarSemestreTurno" class="form-label">Semestre</label>
                                <select id="editarSemestreTurno" class="form-select">
                                    <option value="1">1¬∫ Semestre</option>
                                    <option value="2">2¬∫ Semestre</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="editarEstadoTurno" class="form-label">Estado do Turno</label>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="editarEstadoTurno">
                                    <label class="form-check-label" for="editarEstadoTurno">
                                        Ativo
                                    </label>
                                </div>
                            </div>

                        </form>
                    </div>

                    <div class="modal-footer">

                        <button type="button" class="btn btn-primary" id="btnGuardarTurno"
                            onclick="enviarFormularioEditarTurno()" disabled>
                            <i class="bi bi-save me-2"></i>Guardar
                        </button>
                    </div>
                </div>
            </div>
        </div>



        <!-- Modal para Gerenciar Alunos -->
        <div class="modal fade" id="editarVagasModal" tabindex="-1" aria-labelledby="editarVagasModalLabel"
            aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editarVagasModalLabel">Gerenciar Alunos do Turno</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <!-- Lista de Alunos -->
                        <h6>Alunos Inscritos</h6>
                        <ul class="list-group mb-3" id="listaAlunosTurno">
                            <!-- Lista ser√° preenchida dinamicamente -->
                        </ul>
                        <!-- Bot√µes de A√ß√£o -->
                        <div class="d-flex justify-content-between">
                            <button type="button" class="btn btn-success btn-sm" onclick="adicionarAluno()">Adicionar
                                Aluno</button>
                            <button type="button" class="btn btn-danger btn-sm" onclick="removerAluno()">Remover
                                Aluno</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal para Eliminar Turno -->
        <div class="modal fade" id="eliminarTurnoModal" tabindex="-1" aria-labelledby="eliminarTurnoModalLabel"
            aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="eliminarTurnoModalLabel">Confirmar Exclus√£o-falta verificar aluno
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Tem certeza de que deseja excluir o turno <strong id="turnoNomeExcluir"></strong>?</p>
                        <div id="detalhesTurno">
                            <!-- Detalhes din√¢micos ser√£o inseridos aqui -->
                        </div>
                    </div>
                    <div class="modal-footer">

                        <button type="button" class="btn btn-danger" onclick="confirmarExclusaoTurno()"><i
                                class="bi bi-trash me-2"></i>Excluir</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal para Editar Hor√°rio -->
        <div class="modal fade" id="editarHorarioModal" tabindex="-1" aria-labelledby="editarHorarioModalLabel"
            aria-hidden="true">
            <div class="modal-dialog" style="max-width: calc(100% - 20px); margin: 10px; height: calc(100% - 20px);">
                <div class="modal-content" style="height: 100%;">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editarHorarioModalLabel">Editar Hor√°rio</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <!-- Tabela de Hor√°rios -->
                            <div class="col-md-8">
                                <table class="table table-bordered" style="table-layout: fixed; width: 100%;">

                                    <thead>
                                        <tr>
                                            <th>Hora</th>
                                            <th>Segunda-feira</th>
                                            <th>Ter√ßa-feira</th>
                                            <th>Quarta-feira</th>
                                            <th>Quinta-feira</th>
                                            <th>Sexta-feira</th>
                                        </tr>
                                    </thead>
                                    <tbody id="horariosTableBody2">
                                        <!-- Dados din√¢micos preenchidos via JS -->
                                    </tbody>
                                </table>
                            </div>
                            <!-- Disciplinas Dispon√≠veis -->
                            <div class="col-md-4">
                                <h6>Disciplinas Dispon√≠veis</h6>
                                <div id="disciplinasDisponiveis" class="border p-3"
                                    style="height: calc(100% - 40px); overflow-y: auto;">
                                    <!-- Dados din√¢micos preenchidos via JS -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">

                        <button type="button" class="btn btn-primary" onclick="salvarHorarios()">Salvar
                            Altera√ß√µes</button>
                    </div>
                </div>
            </div>
        </div>






        <script>
            // üöÄ Fun√ß√£o gen√©rica para preencher selects
            function preencherSelect(selectElement, dados, defaultOption) {
                selectElement.innerHTML = `<option selected disabled>${defaultOption}</option>`;
                dados.forEach(item => {
                    const option = document.createElement('option');
                    option.value = item.id || item.id_ano || item.id_semestre || item.id_curso;
                    option.textContent = item.nome || item.nome_ano || item.nome_semestre || item.nome_curso;
                    selectElement.appendChild(option);
                });
            }

            // ‚úÖ Fun√ß√£o para carregar Cursos na Pesquisa e Modal
            function carregarCursos() {
                fetch('/obter_cursos/')
                    .then(response => response.json())
                    .then(data => {
                        // Preenche o seletor de cursos na pesquisa
                        const selectCursoPesquisa = document.getElementById('cursoPesquisa');
                        preencherSelect(selectCursoPesquisa, data, 'Escolha o curso...');

                        // Preenche o seletor de cursos no modal
                        const selectCursoTurno = document.getElementById('cursoTurno');
                        preencherSelect(selectCursoTurno, data, 'Escolha o curso...');
                    })
                    .catch(error => console.error('Erro ao carregar cursos:', error));
            }

            // ‚úÖ Fun√ß√£o para carregar Anos
            function carregarAnos() {
                fetch('/obter_anos/')
                    .then(response => response.json())
                    .then(data => {
                        const selectAno = document.getElementById('anoTurno');
                        preencherSelect(selectAno, data, 'Escolha o ano...');
                    })
                    .catch(error => console.error('Erro ao carregar anos:', error));
            }

            // ‚úÖ Fun√ß√£o para carregar Semestres
            function carregarSemestres() {
                fetch('/obter_semestres/')
                    .then(response => response.json())
                    .then(data => {
                        const selectSemestre = document.getElementById('semestreTurno');
                        preencherSelect(selectSemestre, data, 'Escolha o semestre...');
                    })
                    .catch(error => console.error('Erro ao carregar semestres:', error));
            }

            // ‚úÖ Inicializar fun√ß√µes ao carregar a p√°gina
            document.addEventListener('DOMContentLoaded', () => {
                carregarCursos();
                carregarAnos();
                carregarSemestres();
            });
            // üöÄ Fun√ß√£o para carregar nomes de turnos
            function carregarNomesTurnos() {
                fetch('/obter_nomes_turnos/')
                    .then(response => response.json())
                    .then(data => {
                        const selectNomeTurno = document.getElementById('selectNomeTurno');
                        selectNomeTurno.innerHTML = '<option selected disabled>Escolha um turno existente...</option>';
                        data.forEach(turno => {
                            const option = document.createElement('option');
                            option.value = turno;
                            option.textContent = turno;
                            selectNomeTurno.appendChild(option);
                        });
                    })
                    .catch(error => console.error('Erro ao carregar nomes de turnos:', error));
            }

            // üöÄ Sincronizar Dropdown e Input de Turno
            document.getElementById('selectNomeTurno').addEventListener('change', function () {
                const inputNomeTurno = document.getElementById('inputNomeTurno');
                inputNomeTurno.value = this.value;
            });

            // üöÄ Chamar ao Carregar a P√°gina
            document.addEventListener('DOMContentLoaded', () => {
                carregarNomesTurnos();
            });
            function carregarUCs() {
                const curso = document.getElementById('cursoTurno').options[document.getElementById('cursoTurno').selectedIndex].text;
                const ano = document.getElementById('anoTurno').options[document.getElementById('anoTurno').selectedIndex].text;
                const semestre = document.getElementById('semestreTurno').options[document.getElementById('semestreTurno').selectedIndex].text;
                const selectUC = document.getElementById('ucTurno');

                if (!curso || !ano || !semestre || curso === 'Escolha o curso...' || ano === 'Escolha o ano...' || semestre === 'Escolha o semestre...') {
                    console.warn('Selecione Curso, Ano e Semestre antes de carregar as UCs.');
                    selectUC.innerHTML = '<option selected disabled>Selecione Curso, Ano e Semestre</option>';
                    return;
                }

                selectUC.innerHTML = '<option disabled selected>Carregando UCs...</option>';

                console.log(`Par√¢metros enviados: curso=${curso}, ano=${ano}, semestre=${semestre}`);

                fetch(`/obter_ucs/?curso=${encodeURIComponent(curso)}&ano=${encodeURIComponent(ano)}&semestre=${encodeURIComponent(semestre)}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Erro ao carregar UCs');
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log('Dados recebidos:', data);
                        selectUC.innerHTML = '<option selected disabled>Escolha uma UC...</option>';
                        if (data.length > 0) {
                            data.forEach(uc => {
                                const option = document.createElement('option');
                                option.value = uc.id_uc;
                                option.textContent = uc.nome_uc;
                                selectUC.appendChild(option);
                            });
                        } else {
                            selectUC.innerHTML = '<option selected disabled>Nenhuma UC encontrada</option>';
                        }
                    })
                    .catch(error => {
                        console.error('Erro ao carregar UCs:', error);
                        selectUC.innerHTML = '<option selected disabled>Erro ao carregar UCs</option>';
                    });
            }


            // Adiciona eventos para garantir que as UCs s√£o carregadas ap√≥s sele√ß√£o dos tr√™s campos
            ['cursoTurno', 'anoTurno', 'semestreTurno'].forEach(id => {
                document.getElementById(id).addEventListener('change', () => {
                    const curso = document.getElementById('cursoTurno').value;
                    const ano = document.getElementById('anoTurno').value;
                    const semestre = document.getElementById('semestreTurno').value;

                    if (curso && ano && semestre) {
                        carregarUCs();
                    }
                });
            });


            // Adiciona eventos nos selects para garantir a atualiza√ß√£o correta
            document.getElementById('cursoTurno').addEventListener('change', carregarUCs);
            document.getElementById('anoTurno').addEventListener('change', carregarUCs);
            document.getElementById('semestreTurno').addEventListener('change', carregarUCs);
            // Chama a fun√ß√£o ao carregar a p√°gina
            document.addEventListener('DOMContentLoaded', function () {
                carregarCursosPesquisa(); // Carrega cursos para pesquisa ao carregar a p√°gina
            });

            function pesquisarDados() {
                console.log('Pesquisando turnos...');
                const cursoSelecionado = document.getElementById('cursoPesquisa').value;
                const anoSelecionado = document.getElementById('ano');
                const anoTexto = anoSelecionado.options[anoSelecionado.selectedIndex].text.trim();

                const semestreSelecionado = document.getElementById('semestre');
                const semestreTexto = semestreSelecionado.options[semestreSelecionado.selectedIndex].text.trim();

                // Verificar se todos os campos foram selecionados
                if (cursoSelecionado === "Escolha o curso..." || !cursoSelecionado ||
                    anoSelecionado === "Escolha o ano..." || !anoSelecionado ||
                    semestreSelecionado === "Escolha o semestre..." || !semestreSelecionado) {
                    alert('Por favor, selecione o curso, ano e semestre para fazer a pesquisa.');
                    return;
                }

                console.log('Par√¢metros de pesquisa:', {
                    curso: cursoSelecionado,
                    ano: anoTexto,
                    semestre: semestreTexto
                });

                // Enviar solicita√ß√£o para buscar dados com base nos par√¢metros
                fetch(`/buscar_dados/?curso=${cursoSelecionado}&ano=${anoTexto}&semestre=${semestreTexto}`)
                    .then(response => {
                        console.log('Resposta do servidor:', response);
                        return response.json();
                    })
                    .then(data => {
                        console.log('Dados recebidos:', data);
                        const tabelaResultados = document.getElementById('resultadosDisponiveis');
                        tabelaResultados.innerHTML = ''; // Limpa os resultados antigos

                        const quantidadeResultados = document.getElementById('quantidadeResultados');
                        quantidadeResultados.textContent = data.length; // Atualiza a quantidade de resultados

                        if (data.length > 0) {
                            // Mostrar o spinner
                            document.getElementById('loadingSpinner').style.display = 'block';
                            tabelaResultados.innerHTML = ''; // Limpar a tabela enquanto carrega

                            data.forEach(item => {
                                const row = `
        <tr>
            <td>${item.turno_nome}</td>
            <td>${item.vagas_disponiveis} Vagas</td>
            <td>${item.vagas_totais ? item.vagas_totais + ' Vagas' : 'N/A Vagas'}</td>
            <td>
                <span class="badge ${item.estado === '1' ? 'bg-success' : 'bg-secondary'}">
                    ${item.estado === '1' ? 'Ativo' : 'Inativo'}
                </span>
            </td>
            <td>
                <!-- Bot√£o para Editar Turno -->
                <button type="button" class="btn btn-warning btn-sm" onclick="editarTurno(${item.id_turno})">
                    <i class="bi bi-pencil"></i> Editar Turno
                </button>
                <!-- Bot√£o para Editar Vagas -->
                <button type="button" class="btn btn-info btn-sm"
                        onclick="editarVagas(${item.id_turno})">
                    Editar Vagas
                </button>
                <!-- Bot√£o para Eliminar Turno -->
                <button type="button" class="btn btn-danger btn-sm"
                        onclick="eliminarTurno(${item.id_turno})">
                    <i class="bi bi-trash me-2"></i>Eliminar Turno
                </button>
            </td>
        </tr>
        `;
                                tabelaResultados.innerHTML += row;
                            });

                            // Ocultar o spinner ap√≥s o carregamento
                            document.getElementById('loadingSpinner').style.display = 'none';
                        }
                        else {
                            tabelaResultados.innerHTML = `
                    <tr>
                        <td colspan="5">Nenhum dado dispon√≠vel para os crit√©rios selecionados.</td>
                    </tr>
                `;
                        }
                    })
                    .catch(error => console.error('Erro ao buscar dados:', error));
            }
            function carregarHorarios(turnoNome, semestre, ano, curso) {
                let tableBody = document.getElementById('horariosTableBody');
                tableBody.innerHTML = '<tr><td colspan="6">Carregando...</td></tr>';

                let params = new URLSearchParams({
                    turno_nome: turnoNome,
                    semestre: semestre.replace(' ', ''),
                    ano: ano.replace(' ', ''),
                    curso: curso
                });

                console.log('Par√¢metros enviados:', params.toString());

                fetch(`/funcionario/obter_horarios/?${params.toString()}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`Erro HTTP: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log('Dados recebidos:', data);
                        tableBody.innerHTML = ''; // Limpa a tabela

                        // Definir intervalo de hor√°rios em blocos de 30 minutos
                        let startTime = new Date('1970-01-01T08:00:00');
                        let endTime = new Date('1970-01-01T18:00:00');
                        let currentTime = new Date(startTime);

                        // Fun√ß√£o para formatar hora
                        function formatTime(date) {
                            return date.toTimeString().split(':').slice(0, 2).join(':');
                        }

                        // Preencher a tabela com blocos de 30 minutos
                        while (currentTime < endTime) {
                            let nextTime = new Date(currentTime);
                            nextTime.setMinutes(currentTime.getMinutes() + 30); // Avan√ßa 30 minutos

                            let row = `<tr><td>${formatTime(currentTime)} - ${formatTime(nextTime)}</td>`;

                            ['Segunda-feira', 'Ter√ßa-feira', 'Quarta-feira', 'Quinta-feira', 'Sexta-feira'].forEach(dia => {
                                let horarioOcupado = data.find(horario => {
                                    let horarioInicio = new Date(`1970-01-01T${horario.hora_inicio}`);
                                    let horarioFim = new Date(`1970-01-01T${horario.hora_fim}`);
                                    return horario.dia_semana === dia &&
                                        currentTime >= horarioInicio &&
                                        currentTime < horarioFim;
                                });

                                if (horarioOcupado) {
                                    let horarioInicio = new Date(`1970-01-01T${horarioOcupado.hora_inicio}`);
                                    let horarioFim = new Date(`1970-01-01T${horarioOcupado.hora_fim}`);
                                    let rowspan = (horarioFim - horarioInicio) / (30 * 60 * 1000); // N√∫mero de blocos de 30 min

                                    // Apenas insere se estiver no in√≠cio do intervalo
                                    if (currentTime.getTime() === horarioInicio.getTime()) {
                                        row += `<td rowspan="${rowspan}" style="background-color: #007bff; color: white; text-align: center; vertical-align: middle;">
                                ${horarioOcupado.nome_uc} <br> Sala: ${horarioOcupado.espaco}
                            </td>`;
                                    }
                                } else {
                                    row += `<td></td>`; // C√©lula vazia
                                }
                            });

                            row += `</tr>`;
                            tableBody.innerHTML += row;
                            currentTime = nextTime; // Avan√ßa para o pr√≥ximo intervalo
                        }
                    })
                    .catch(error => {
                        console.error('Erro ao carregar hor√°rios:', error);
                        tableBody.innerHTML = '<tr><td colspan="6">Erro ao carregar hor√°rios. Tente novamente mais tarde.</td></tr>';
                    });
            }


            // Bot√£o para carregar os hor√°rios
            function carregarHorariosComData(button) {
                const turnoNome = button.getAttribute('data-turno-nome');
                const semestre = button.getAttribute('data-semestre');
                const ano = button.getAttribute('data-ano');
                const curso = button.getAttribute('data-curso');

                carregarHorarios(turnoNome, semestre, ano, curso);
            }



            function enviarFormularioCriarTurno() {
                // Captura dos elementos do formul√°rio
                const selectNomeTurno = document.getElementById('selectNomeTurno');
                const inputNomeTurno = document.getElementById('inputNomeTurno');
                const vagasTurno = document.getElementById('vagasTurno');
                const cursoTurno = document.getElementById('cursoTurno');
                const anoTurno = document.getElementById('anoTurno');
                const semestreTurno = document.getElementById('semestreTurno');
                const ucTurno = document.getElementById('ucTurno');

                // Valida√ß√£o b√°sica dos campos
                if (!cursoTurno.value || !anoTurno.value || !semestreTurno.value || !ucTurno.value) {
                    alert('‚ö†Ô∏è Por favor, preencha todos os campos obrigat√≥rios antes de salvar.');
                    return;
                }

                // Determinar qual nome do turno usar
                const nomeTurno = inputNomeTurno.value.trim() !== ''
                    ? inputNomeTurno.value
                    : selectNomeTurno.value;

                if (!nomeTurno) {
                    alert('‚ö†Ô∏è Por favor, selecione ou insira um nome para o turno.');
                    return;
                }

                // Constru√ß√£o do objeto com os dados para envio
                const formData = {
                    nome_turno: nomeTurno,
                    vagas_turno: parseInt(vagasTurno.value) || 0,
                    id_curso: parseInt(cursoTurno.value) || 0,
                    ano_turno: parseInt(anoTurno.value) || 0,
                    semestre_turno: parseInt(semestreTurno.value) || 0,
                    id_uc: parseInt(ucTurno.value) || 0
                };

                console.log('üì§ Dados enviados:', formData);

                // Envio dos dados para o backend
                fetch('/criar_turno/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken')
                    },
                    body: JSON.stringify(formData)
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`Erro HTTP: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        const modalBody = document.querySelector('#criarTurnoModal .modal-body');
                        const modalContent = document.querySelector('#criarTurnoModal .modal-content');
                        const btnSalvar = document.querySelector('#criarTurnoModal .modal-footer .btn-primary');

                        if (data.success) {
                            // üü¢ Modal de Sucesso
                            modalBody.innerHTML = `
                    <div class="text-center">
                        <h4 class="text-success">‚úÖ Turno criado com sucesso!</h4>
                        
                    </div>
                `;
                            modalContent.style.backgroundColor = '#d4edda'; // Fundo verde
                            modalContent.style.color = '#155724'; // Texto verde escuro
                            if (btnSalvar) {
                                btnSalvar.style.display = 'none';
                            }
                        } else {
                            // üî¥ Modal de Erro
                            modalBody.innerHTML = `
                    <div class="text-center">
                        <p>${data.error}</p>
                       
                    </div>
                `;
                            modalContent.style.backgroundColor = '#f8d7da'; // Fundo vermelho
                            modalContent.style.color = '#721c24'; // Texto vermelho escuro
                            if (btnSalvar) {
                                btnSalvar.style.display = 'none';
                            }
                        }

                    })
                    .catch(error => {
                        console.error('‚ùå Erro ao criar turno:', error);
                        const modalBody = document.querySelector('#criarTurnoModal .modal-body');
                        const modalContent = document.querySelector('#criarTurnoModal .modal-content');
                        const btnSalvar = document.querySelector('#criarTurnoModal .modal-footer .btn-primary');

                        // üî¥ Modal de Erro Cr√≠tico
                        modalBody.innerHTML = `
                <div class="text-center">
                    <h4 class="text-danger">‚ùå Erro cr√≠tico ao criar turno</h4>
                    <p>${error.message}</p>
                   
                </div>
            `;
                        modalContent.style.backgroundColor = '#f8d7da'; // Fundo vermelho
                        modalContent.style.color = '#721c24'; // Texto vermelho escuro
                        if (btnSalvar) {
                            btnSalvar.style.display = 'none';
                        }


                    });
            }


            
            function resetarModal() {
                const modal = document.getElementById('criarTurnoModal');
                if (modal) {
                    modal.remove(); // Remove o modal do DOM
                }

                // Reinsere o modal no DOM
                const modalContainer = document.createElement('div');
                modalContainer.innerHTML = `
        <!-- Estrutura original do modal -->
        <div class="modal fade" id="criarTurnoModal" tabindex="-1" aria-labelledby="criarTurnoModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="criarTurnoModalLabel">Criar Novo Turno</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="formCriarTurno" onsubmit="event.preventDefault(); enviarFormularioCriarTurno();">
                            <div class="mb-3">
                                <label for="nomeTurno" class="form-label">Nome do Turno</label>
                                <div class="input-group">
                                    <select class="form-select" id="selectNomeTurno">
                                        <option selected disabled>Escolha um turno existente...</option>
                                    </select>
                                    <input type="text" class="form-control" id="inputNomeTurno" placeholder="Ou digite um novo nome">
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="vagasTurno" class="form-label">N√∫mero de Vagas</label>
                                <input type="number" class="form-control" id="vagasTurno" placeholder="Digite o n√∫mero de vagas" required>
                            </div>
                            <div class="mb-3">
                                <label for="cursoTurno" class="form-label">Curso</label>
                                <select class="form-select" id="cursoTurno" required>
                                    <option selected disabled>Escolha o curso...</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="anoTurno" class="form-label">Ano</label>
                                <select class="form-select" id="anoTurno" required>
                                    <option selected disabled>Escolha o ano...</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="semestreTurno" class="form-label">Semestre</label>
                                <select class="form-select" id="semestreTurno" required>
                                    <option selected disabled>Escolha o semestre...</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="ucTurno" class="form-label">Unidade Curricular (UC)</label>
                                <select class="form-select" id="ucTurno" required>
                                    <option selected disabled>Selecione Curso, Ano e Semestre</option>
                                </select>
                            </div>
                            <div class="modal-footer">
                                <button type="submit" class="btn btn-primary"><i class="bi bi-save me-2"></i>Guardar</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    `;
                document.body.appendChild(modalContainer);

                console.log('üîÑ Modal recriado com sucesso!');
            }
            const botaoAbrirModal = document.querySelector('[data-bs-target="#criarTurnoModal"]');
            if (botaoAbrirModal) {
                botaoAbrirModal.addEventListener('click', () => {
                    resetarModal();
                    carregarNomesTurnos();
                    carregarCursos();
                    carregarAnos();
                    carregarSemestres();
                    carregarUCs();
                    console.log('üì• Modal resetado e dados carregados.');
                });
            }


            // Fun√ß√£o para obter o CSRF token
            function getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    const cookies = document.cookie.split(';');
                    for (let i = 0; i < cookies.length; i++) {
                        const cookie = cookies[i].trim();
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
        </script>
        <script>
            let turnoOriginal = {};
            // Armazenar o conte√∫do original do modal
            const modalBodyOriginal = document.querySelector('#editarTurnoModal .modal-body').innerHTML;
            const modalFooterOriginal = document.querySelector('#editarTurnoModal .modal-footer').innerHTML;

            function editarTurno(idTurno) {
                console.log('Editando turno com ID:', idTurno);
                // Armazenar o ID do turno no campo oculto
                // Restaurar o conte√∫do original do modal antes de preencher
                document.querySelector('#editarTurnoModal .modal-content').style.backgroundColor = '#FFFFFF';
                document.querySelector('#editarTurnoModal .modal-body').innerHTML = modalBodyOriginal;
                document.querySelector('#editarTurnoModal .modal-footer').innerHTML = modalFooterOriginal;

                // Enviar solicita√ß√£o para obter os detalhes do turno
                fetch(`/obter_detalhes_turno/${idTurno}/`)
                    .then(response => response.json())
                    .then(data => {
                        console.log('Dados recebidos:', data);
                        // Armazenar os valores originais
                        turnoOriginal = {
                            nome: data.turno_nome,
                            vagasTotais: data.vagas_totais,
                            ano: data.ano,
                            semestre: data.semestre,
                            estado: data.estado
                        };
                        // Preencher o formul√°rio com os dados do turno
                        document.getElementById('editarNomeTurno').value = data.turno_nome;
                        const turnoIdElement = document.getElementById('editTurnoId');
                        if (turnoIdElement) {
                            turnoIdElement.value = data.id_turno;
                            //  console.log(`ID do turno definido no campo oculto: ${turnoIdElement.value}`);
                        } else {
                            console.error("Erro: O campo oculto 'editTurnoId' n√£o foi encontrado.");
                            return;
                        }
                        // Definir ano e semestre
                        const anoSelect = document.getElementById('editarAnoTurno');
                        for (let i = 0; i < anoSelect.options.length; i++) {
                            if (anoSelect.options[i].text.includes(data.ano)) {
                                anoSelect.selectedIndex = i;
                                break;
                            }
                        }

                        const semestreSelect = document.getElementById('editarSemestreTurno');
                        for (let i = 0; i < semestreSelect.options.length; i++) {
                            if (semestreSelect.options[i].text.includes(data.semestre)) {
                                semestreSelect.selectedIndex = i;
                                break;
                            }
                        }

                        // Preencher o valor das vagas totais
                        document.getElementById('editarVagasTotais').value = data.vagas_totais;

                        // Calcular vagas ocupadas
                        const vagasOcupadas = data.vagas_totais - data.vagas_disponiveis;
                        // console.log('Vagas Ocupadas calculadas:', vagasOcupadas);

                        // Mostrar o modal do Bootstrap
                        const editarModal = new bootstrap.Modal(document.getElementById('editarTurnoModal'));

                        // Preencher o valor das vagas ocupadas ANTES de mostrar o modal
                        const vagasOcupadasTexto = document.getElementById('vagasOcupadasTexto');
                        if (vagasOcupadasTexto) {
                            vagasOcupadasTexto.innerHTML = `Numero de Vagas ocupadas: <strong>${vagasOcupadas}</strong>`; // Definir a frase com o valor em negrito
                            // console.log('Frase atribu√≠da ao campo vagasOcupadasTexto:', vagasOcupadasTexto.innerHTML);
                        }
                        else {
                            console.error('Elemento vagasOcupadasTexto n√£o encontrado.');
                        }

                        // Preencher o estado do turno (1 = Ativo, 0 = Inativo)
                        const estadoCheckbox = document.getElementById('editarEstadoTurno');
                        if (estadoCheckbox) {
                            estadoCheckbox.checked = data.estado === 1;
                            // console.log('Estado do turno:', data.estado === 1 ? 'Ativo' : 'Inativo');
                        } else {
                            console.error('Elemento editarEstadoTurno n√£o encontrado.');
                        }

                        // Mostrar o modal
                        // Adicionar eventos para monitorar mudan√ßas
                        monitorarMudancas();
                        validarVagasTotais();
                        editarModal.show();
                    })
                    .catch(error => console.error('Erro ao obter detalhes do turno:', error));
            }

            function mostrarMensagem(tipo, mensagem) {
                alert(`[${tipo}] ${mensagem}`);
            }

            function monitorarMudancas() {
                const btnGuardar = document.getElementById('btnGuardarTurno');

                // Monitorar mudan√ßas nos campos
                document.querySelectorAll('#editarTurnoModal input, #editarTurnoModal select').forEach((campo) => {
                    campo.addEventListener('input', () => {
                        const nomeAlterado = document.getElementById('editarNomeTurno').value !== turnoOriginal.nome;
                        const vagasTotaisAlteradas = document.getElementById('editarVagasTotais').value != turnoOriginal.vagasTotais;
                        const anoAlterado = document.getElementById('editarAnoTurno').value !== turnoOriginal.ano;
                        const semestreAlterado = document.getElementById('editarSemestreTurno').value !== turnoOriginal.semestre;
                        const estadoAlterado = document.getElementById('editarEstadoTurno').checked !== (turnoOriginal.estado === 1);

                        // Habilitar bot√£o se qualquer campo for alterado
                        if (nomeAlterado || vagasTotaisAlteradas || anoAlterado || semestreAlterado || estadoAlterado) {
                            btnGuardar.removeAttribute('disabled');
                        } else {
                            btnGuardar.setAttribute('disabled', 'disabled');
                        }
                    });
                });
            }

            function validarVagasTotais() {
                const vagasTotaisInput = document.getElementById('editarVagasTotais');
                const vagasOcupadas = parseInt(turnoOriginal.vagasTotais) - parseInt(turnoOriginal.vagasDisponiveis);

                vagasTotaisInput.addEventListener('input', () => {
                    const vagasTotais = parseInt(vagasTotaisInput.value);
                    if (parseInt(vagasTotais) < parseInt(vagasRestantes)) {
                        mostrarMensagem('Erro', 'O n√∫mero de vagas totais deve ser igual ou maior do que o n√∫mero de vagas restantes.');
                        return;
                    }

                });
            }




            function enviarFormularioEditarTurno() {
                // Verificar elementos um por um
                const turnoIdElement = document.getElementById('editTurnoId');
                if (!turnoIdElement) {
                    alert("Erro: O elemento com ID 'editTurnoId' n√£o foi encontrado.");
                    return;
                }

                const nomeTurnoElement = document.getElementById('editarNomeTurno');
                if (!nomeTurnoElement) {
                    alert("Erro: O elemento com ID 'editarNomeTurno' n√£o foi encontrado.");
                    return;
                }

                const vagasTotaisElement = document.getElementById('editarVagasTotais');
                if (!vagasTotaisElement) {
                    alert("Erro: O elemento com ID 'editarVagasTotais' n√£o foi encontrado.");
                    return;
                }

                const vagasRestantesElement = document.getElementById('vagasOcupadasTexto'); // Verifique se voc√™ quer usar 'vagasOcupadasTexto' aqui
                if (!vagasRestantesElement) {
                    alert("Erro: O elemento com ID 'vagasOcupadasTexto' n√£o foi encontrado.");
                    return;
                }

                const anoElement = document.getElementById('editarAnoTurno');
                if (!anoElement) {
                    alert("Erro: O elemento com ID 'editarAnoTurno' n√£o foi encontrado.");
                    return;
                }

                const semestreElement = document.getElementById('editarSemestreTurno');
                if (!semestreElement) {
                    alert("Erro: O elemento com ID 'editarSemestreTurno' n√£o foi encontrado.");
                    return;
                }

                const estadoElement = document.getElementById('editarEstadoTurno');
                if (!estadoElement) {
                    alert("Erro: O elemento com ID 'editarEstadoTurno' n√£o foi encontrado.");
                    return;
                }

                // Obter os valores dos elementos
                const turnoId = turnoIdElement.value;
                const nomeTurno = nomeTurnoElement.value;

                // Aqui usamos o texto das op√ß√µes selecionadas
                const ano = anoElement.options[anoElement.selectedIndex].text;
                const semestre = semestreElement.options[semestreElement.selectedIndex].text;
                // console.log(`Ano enviado: ${ano}`);
                //console.log(`Semestre enviado: ${semestre}`);
                const estado = estadoElement.checked ? 1 : 0;

                const vagasTotais = parseInt(vagasTotaisElement.value)
                const vagasOcupadas = parseInt(vagasRestantesElement.textContent.split(':')[1].trim());

                // Adicionar logs para verificar os valores
                //console.log(`Vagas Totais informadas: ${vagasTotaisElement.value}`);
                //console.log(`Vagas Restantes no texto: ${vagasRestantesElement.textContent.split(':')[1].trim()}`);
                //console.log(`Vagas Ocupadas calculadas: ${vagasOcupadas}`);

                // Validar se vagas totais s√£o maiores ou iguais √†s vagas ocupadas
                if (vagasTotais < vagasOcupadas) {
                    alert('Erro: O n√∫mero de vagas totais deve ser maior ou igual ao n√∫mero de vagas ocupadas.');
                    return;
                }


                // Enviar os dados via AJAX
                fetch('/atualizar_turno/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'X-CSRFToken': getCookie('csrftoken')
                    },
                    body: new URLSearchParams({
                        'turno_id': turnoId,
                        'nome_turno': nomeTurno,
                        'vagas_totais': vagasTotais,
                        'ano': ano,
                        'semestre': semestre,
                        'estado': estado
                    })
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // Substituir conte√∫do do modal com mensagem de sucesso
                            const modalBody = document.querySelector('#editarTurnoModal .modal-body');
                            modalBody.innerHTML = `
                    <div class="text-center">
                        <h4 class="text-success">Turno atualizado com sucesso!</h4>
                        <img src="{% static 'images/certo.png' %}" alt="Sucesso" style="width: 100px; margin-top: 20px;">
                    </div>
                `;

                            // Mudar a cor do fundo do modal para verde
                            document.querySelector('#editarTurnoModal .modal-content').style.backgroundColor = '#d4edda';

                            // Remover o bot√£o "Guardar"
                            const btnGuardar = document.querySelector('#editarTurnoModal .modal-footer .btn-primary');
                            if (btnGuardar) {
                                btnGuardar.style.display = 'none'; // Esconde o bot√£o "Guardar"
                            }



                            pesquisarDados(); // Atualizar a lista de turnos
                            // Atualizar a lista
                        } else {
                            alert('Erro ao atualizar turno: ' + data.error);
                        }
                    })
                    .catch(error => console.error('Erro ao atualizar turno:', error));
            }


            // Fun√ß√£o para obter o CSRF token
            function getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    const cookies = document.cookie.split(';');
                    for (let i = 0; i < cookies.length; i++) {
                        const cookie = cookies[i].trim();
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }


        </script>
        <script>
            function editarVagas(idTurno) {
                console.log('Abrindo modal para gerenciar alunos do turno:', idTurno);

                // Enviar solicita√ß√£o para obter os detalhes do turno e alunos inscritos
                fetch(`/obter_alunos_turno/${idTurno}/`)
                    .then(response => response.json())
                    .then(data => {
                        console.log('Dados do turno recebidos:', data);

                        // Preencher a lista de alunos
                        const listaAlunos = document.getElementById('listaAlunosTurno');
                        listaAlunos.innerHTML = ''; // Limpar a lista atual

                        if (data.alunos && data.alunos.length > 0) {
                            data.alunos.forEach(aluno => {
                                const li = document.createElement('li');
                                li.className = 'list-group-item d-flex justify-content-between align-items-center';
                                li.textContent = aluno.nome; // Exibe o nome do aluno
                                li.dataset.id = aluno.id; // Salva o ID do aluno como atributo
                                listaAlunos.appendChild(li);
                            });
                        } else {
                            listaAlunos.innerHTML = '<li class="list-group-item text-center text-muted">Nenhum aluno inscrito.</li>';
                        }

                        // Abrir o modal do Bootstrap
                        const editarVagasModal = new bootstrap.Modal(document.getElementById('editarVagasModal'));
                        editarVagasModal.show();
                    })
                    .catch(error => {
                        console.error('Erro ao obter os detalhes do turno:', error);
                        alert('Erro ao carregar as informa√ß√µes do turno. Tente novamente.');
                    });
            }
            function adicionarAluno() {
                const turnoId = document.getElementById('idTurnoVagas').value; // ID do turno
                const nomeAluno = prompt('Digite o nome do aluno para adicionar:');
                if (!nomeAluno) {
                    alert('Erro: Nome do aluno n√£o pode estar vazio.');
                    return;
                }

                // Enviar dados ao backend para adicionar o aluno
                fetch('/adicionar_aluno/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'X-CSRFToken': getCookie('csrftoken')
                    },
                    body: new URLSearchParams({
                        'id_turno': turnoId,
                        'nome_aluno': nomeAluno
                    })
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert('Aluno adicionado com sucesso!');
                            editarVagas(turnoId); // Atualiza a lista de alunos
                        } else {
                            alert('Erro ao adicionar aluno: ' + data.error);
                        }
                    })
                    .catch(error => console.error('Erro ao adicionar aluno:', error));
            }
            function removerAluno() {
                const listaAlunos = document.getElementById('listaAlunosTurno');
                const alunosSelecionados = [...listaAlunos.children].filter(li => li.classList.contains('selected'));

                if (alunosSelecionados.length === 0) {
                    alert('Selecione um aluno para remover.');
                    return;
                }

                const alunoId = alunosSelecionados[0].dataset.id; // ID do primeiro aluno selecionado
                const turnoId = document.getElementById('idTurnoVagas').value;

                // Enviar dados ao backend para remover o aluno
                fetch('/remover_aluno/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'X-CSRFToken': getCookie('csrftoken')
                    },
                    body: new URLSearchParams({
                        'id_turno': turnoId,
                        'id_aluno': alunoId
                    })
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert('Aluno removido com sucesso!');
                            editarVagas(turnoId); // Atualiza a lista de alunos
                        } else {
                            alert('Erro ao remover aluno: ' + data.error);
                        }
                    })
                    .catch(error => console.error('Erro ao remover aluno:', error));
            }

        </script>
        <script>
            let turnoParaExcluir = null;

            function eliminarTurno(idTurno) {
                console.log(`Preparando para excluir o turno com ID: ${idTurno}`);

                // Restaurar o modal ao seu estado original
                const modalBody = document.querySelector('#eliminarTurnoModal .modal-body');
                const modalFooter = document.querySelector('#eliminarTurnoModal .modal-footer');

                // Resetar conte√∫do do modal// Restaurar a cor do modal para o padr√£o (branco)
                const modalContent = document.querySelector('#eliminarTurnoModal .modal-content');
                if (modalContent) {
                    modalContent.style.backgroundColor = '#FFFFFF'; // Cor branca padr√£o
                }

                modalBody.innerHTML = `
        <p>Tem certeza de que deseja excluir o turno <span id="turnoNomeExcluir">...</span>?</p>
        <div id="detalhesTurno"></div>
    `;
                modalFooter.innerHTML = `
        
        <button type="button" class="btn btn-danger" onclick="confirmarExclusaoTurno()" disabled><i class="bi bi-trash me-2"></i>Excluir</button>
    `;

                // Fazer uma requisi√ß√£o para verificar os detalhes do turno
                fetch(`/verificar_eliminar_turno/`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/x-www-form-urlencoded",
                        "X-CSRFToken": getCookie('csrftoken') // Se estiver usando Django com CSRF
                    },
                    body: new URLSearchParams({
                        turno_id: idTurno
                    })
                })
                    .then(response => response.json())
                    .then(data => {
                        console.log('Dados do turno recebidos:', data);

                        if (data.success) {
                            // Preencher o modal com os dados do turno
                            document.getElementById("turnoNomeExcluir").textContent = data.turno_nome || "Desconhecido";
                            turnoParaExcluir = idTurno;
                            // Mostrar mensagem de hor√°rios associados
                            const detalhesElemento = document.getElementById("detalhesTurno");
                            if (data.horarios_associados > 0) {
                                detalhesElemento.innerHTML = `
                        <span class="text-danger">‚úñ Ainda existem <strong>${data.horarios_associados}</strong> hor√°rio(s) associado(s) ao turno!!</span>
                    `;
                            } else {
                                detalhesElemento.innerHTML = `
                        <span class="text-success">‚úî Sem hor√°rios pendentes.</span>
                    `;
                            }

                            // Gerenciar o estado do bot√£o de exclus√£o
                            const btnExcluir = document.querySelector("#eliminarTurnoModal .btn-danger");
                            if (data.posso_eliminar) {
                                btnExcluir.removeAttribute("disabled");
                            } else {
                                btnExcluir.setAttribute("disabled", "disabled");
                            }
                            // Mostrar o modal de confirma√ß√£o
                            const eliminarModal = new bootstrap.Modal(document.getElementById("eliminarTurnoModal"));
                            eliminarModal.show();
                        } else {
                            alert(data.error || "Erro ao verificar o turno.");
                        }
                    })
                    .catch(error => {
                        console.error('Erro ao obter os detalhes do turno:', error);
                        alert('Erro ao carregar os detalhes do turno. Tente novamente.');
                    });
            }



            function confirmarExclusaoTurno() {
                if (!turnoParaExcluir) {
                    alert("Erro: Nenhum turno selecionado para exclus√£o.");
                    return;
                }
                fetch('/eliminar_turno/', {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/x-www-form-urlencoded",
                        "X-CSRFToken": getCookie('csrftoken') // Se estiver usando Django com CSRF
                    },
                    body: new URLSearchParams({
                        turno_id: turnoParaExcluir
                    })
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // Alterar o conte√∫do do modal para mostrar mensagem de sucesso
                            const modalBody = document.querySelector('#eliminarTurnoModal .modal-body');
                            modalBody.innerHTML = `
                    <div class="text-center">
                        <h4 class="text-success">Turno eliminado com sucesso!</h4>
                       <img src="{% static 'images/certo.png' %}" alt="Sucesso" style="width: 100px; margin-top: 20px;">
                    </div>
                `;
                            // Alterar o fundo do modal (opcional)
                            const modalContent = document.querySelector('#eliminarTurnoModal .modal-content');
                            modalContent.style.backgroundColor = '#d4edda';
                            // Desativar os bot√µes no modal (opcional)
                            const btnExcluir = document.querySelector('#eliminarTurnoModal .btn-danger');
                            if (btnExcluir) {
                                btnExcluir.style.display = 'none'; // Esconder o bot√£o
                            }


                            // Atualizar a lista imediatamente
                            pesquisarDados(); // Atualizar a lista
                        } else {
                            alert("Erro ao eliminar turno: " + data.error);
                        }
                    })
                    .catch(error => {
                        console.error("Erro ao eliminar turno:", error);
                        alert("Erro ao eliminar turno. Tente novamente.");
                    });
            }


        </script>
        <script>

            // Fun√ß√£o para carregar os cursos na pesquisa
            function carregarCursosPesquisa_horairos() {
                fetch('/obter_cursos/')
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Erro na requisi√ß√£o: ' + response.status);
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log('Resposta do backend:', data)
                        if (data.error) {
                            console.error('Erro no backend:', data.error);
                            return;
                        }

                        const selectCursoPesquisa = document.getElementById('cursoPesquisa_horarios');
                        selectCursoPesquisa.innerHTML = '<option selected disabled>Escolha o curso...</option>'; // Limpa op√ß√µes antigas

                        // Verifica se h√° dados e popula o seletor
                        if (Array.isArray(data) && data.length > 0) {
                            data.forEach(curso => {
                                const option = document.createElement('option');
                                option.value = curso.id_curso;
                                option.textContent = curso.nome_curso;
                                selectCursoPesquisa.appendChild(option);
                            });
                            console.log('Cursos carregados com sucesso.');
                        } else {
                            console.warn('Nenhum curso encontrado.');
                        }
                    })
                    .catch(error => console.error('Erro ao carregar cursos para pesquisa:', error));
            }

            document.getElementById('horarios-tab').addEventListener('shown.bs.tab', () => {
                console.log('Aba "Hor√°rios" clicada, carregando cursos...');
                carregarCursosPesquisa_horairos();
            });

            function pesquisarHorarios() {
                const cursoId = document.getElementById("cursoPesquisa_horarios").value;

                // Pegando ano e semestre pelos novos IDs
                const anoSelecionado = document.getElementById("ano_horario");
                const ano = anoSelecionado.value.trim();
                const anoTexto = anoSelecionado.options[anoSelecionado.selectedIndex]?.text?.trim() || '';

                const semestreSelecionado = document.getElementById("semestre_horario");
                const semestre = semestreSelecionado.value.trim();
                const semestreTexto = semestreSelecionado.options[semestreSelecionado.selectedIndex]?.text?.trim() || '';

                // Validar se os campos foram preenchidos
                if (!cursoId || !ano || !semestre) {
                    console.error("Erro: Todos os campos s√£o obrigat√≥rios.");
                    console.log("Estado atual dos campos:");
                    console.log(`Curso ID: ${cursoId}`);
                    console.log(`Ano: ${anoTexto || "N√£o selecionado"}`);
                    console.log(`Semestre: ${semestreTexto || "N√£o selecionado"}`);
                    return;
                }

                console.log("Pesquisando hor√°rios para:");
                console.log(`Curso ID: ${cursoId}`);
                console.log(`Ano: ${anoTexto}`);
                console.log(`Semestre: ${semestreTexto}`);

                // Realiza a requisi√ß√£o ao backend
                fetch(`/pesquisar_horarios/?curso_id=${cursoId}&ano=${anoTexto}&semestre=${semestreTexto}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error("Erro ao processar a requisi√ß√£o: " + response.statusText);
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (data.success) {
                            console.log("Hor√°rios encontrados:", data.data);
                            atualizarTabelaHorarios(data.data);
                        } else {
                            console.error("Erro do servidor:", data.error);
                        }
                    })
                    .catch(error => console.error("Erro na requisi√ß√£o:", error));
            }

            function atualizarTabelaHorarios(horarios) {
                const tabelaResultados = document.getElementById("resultadosDisponiveis_horarios");
                tabelaResultados.innerHTML = ""; // Limpa os resultados anteriores

                if (horarios.length === 0) {
                    tabelaResultados.innerHTML = "<tr><td colspan='5'>Nenhum hor√°rio encontrado.</td></tr>";
                    return;
                }

                horarios.forEach(horario => {
                    const row = `
        <tr id="horario-${horario.id_turno}-${horario.ano}-${horario.semestre}">
            <td>${horario.turno_nome}</td>
            <td>${horario.curso_nome}</td>
            <td>${horario.ano}</td>
            <td>${horario.semestre}</td>
            <td>
    <button type="button" class="btn btn-primary btn-sm"
        data-id-turno="${horario.id_turno}" 
        onclick="carregarHorariosComData_horarios(this)">
    <i class="bi bi-eye"></i> Ver Hor√°rio
</button>

</td>
<td>
 <button type="button" class="btn btn-warning btn-sm"
            data-id-turno="${horario.id_turno}" 
            data-curso-id="${horario.curso_nome}"
            data-ano="${horario.ano}"
            data-semestre="${horario.semestre}"
            data-bs-toggle="modal"
            data-bs-target="#editarHorarioModal"
            onclick="carregarModalEditarHorario(this)">
            <i class="bi bi-pencil"></i> Editar Hor√°rio
        </button>


</td>

        </tr>
    `;
                    tabelaResultados.innerHTML += row;
                });
            }

            function carregarHorariosComData_horarios(button) {
                const idTurno = button.getAttribute('data-id-turno');
                if (!idTurno) {
                    console.error("Erro: ID do turno n√£o encontrado.");
                    return;
                }
                carregarHorarios_2(idTurno);
                const modal = new bootstrap.Modal(document.getElementById("horarioModal"));
                modal.show(); // Abre o modal manualmente
            }

            function carregarHorarios_2(idTurno) {
                const tableBody = document.getElementById('horariosTableBody');
                tableBody.innerHTML = '<tr><td colspan="6">Carregando...</td></tr>'; // Exibe carregando inicialmente

                fetch(`/funcionario/obter_horarios/${idTurno}/`) // Substitua pela rota correta
                    .then(response => response.json())
                    .then(data => {
                        tableBody.innerHTML = ''; // Limpa os dados anteriores

                        // Define o intervalo de hor√°rios das 8h √†s 18h em intervalos de 1 hora
                        const startTime = new Date('1970-01-01T08:00:00');
                        const endTime = new Date('1970-01-01T18:00:00');
                        let currentTime = new Date(startTime);

                        // Fun√ß√£o para formatar o hor√°rio
                        function formatTime(date) {
                            return date.toTimeString().split(':').slice(0, 2).join(':');
                        }

                        // Preenche a tabela com intervalos de 1 hora
                        while (currentTime < endTime) {
                            const nextTime = new Date(currentTime);
                            nextTime.setMinutes(currentTime.getMinutes() + 60); // Incrementa 1 hora

                            // Define estilo para hor√°rio entre 12:00 e 13:00
                            const rowClass = formatTime(currentTime) === '12:00' ? 'style="background-color: #f1f1f1;"' : '';

                            // Cria a linha com intervalo de hor√°rio
                            let row = `<tr ${rowClass}><td>${formatTime(currentTime)} - ${formatTime(nextTime)}</td>`;

                            // Adiciona colunas para os dias da semana
                            ['Segunda-feira', 'Ter√ßa-feira', 'Quarta-feira', 'Quinta-feira', 'Sexta-feira'].forEach(dia => {
                                const horarioOcupado = data.find(horario => {
                                    const horarioInicio = new Date(`1970-01-01T${horario.hora_inicio}`);
                                    const horarioFim = new Date(`1970-01-01T${horario.hora_fim}`);
                                    return horario.dia_semana === dia &&
                                        currentTime >= horarioInicio &&
                                        currentTime < horarioFim;
                                });

                                if (horarioOcupado) {
                                    const horarioInicio = new Date(`1970-01-01T${horarioOcupado.hora_inicio}`);
                                    const horarioFim = new Date(`1970-01-01T${horarioOcupado.hora_fim}`);
                                    const rowspan = (horarioFim - horarioInicio) / (60 * 60 * 1000); // Calcula o rowspan

                                    // Apenas insere a c√©lula se estiver no in√≠cio do intervalo
                                    if (currentTime.getTime() === horarioInicio.getTime()) {
                                        row += `
                                <td rowspan="${rowspan}" style="background-color: #007bff; color: white; text-align: center; vertical-align: middle;">
                                    ${horarioOcupado.nome_uc}
                                </td>`;
                                    }
                                } else {
                                    row += '<td></td>'; // C√©lula vazia para hor√°rios livres
                                }
                            });

                            // Fecha a linha e adiciona ao corpo da tabela
                            row += '</tr>';
                            tableBody.innerHTML += row;

                            // Avan√ßa para o pr√≥ximo intervalo de tempo
                            currentTime = nextTime;
                        }
                    })
                    .catch(error => {
                        console.error('Erro ao carregar hor√°rios:', error);
                        tableBody.innerHTML = '<tr><td colspan="6">Erro ao carregar hor√°rios. Tente novamente mais tarde.</td></tr>';
                    });
            }
        </script>

        <script>
            function carregarModalEditarHorario(button) {
                const idTurno = button.getAttribute("data-id-turno");
                const curso_nome = button.getAttribute("data-curso-id");
                const ano = button.getAttribute("data-ano");
                const semestre = button.getAttribute("data-semestre");

                // Primeiro fetch para obter o ID do curso
                fetch(`/obter_id_curso/${encodeURIComponent(curso_nome)}/`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            const cursoId = data.curso_id; // Obt√©m o ID do curso
                            console.log("ID do Curso:", cursoId);

                            // Segundo fetch para obter hor√°rios e UCs
                            return fetch(`/obter_horarios_e_ucs/${idTurno}/${cursoId}/${ano}/${semestre}/`);
                        } else {
                            console.error("Erro ao obter o ID do curso:", data.error);
                            throw new Error(data.error);
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            console.log("Hor√°rios encontrados:", data.horarios);
                            console.log("Unidades curriculares dispon√≠veis:", data.ucs_disponiveis);

                            // Preencher a tabela de hor√°rios
                            preencherTabelaHorarios(data.horarios);

                            // Preencher as disciplinas dispon√≠veis
                            preencherDisciplinasDisponiveis(data.ucs_disponiveis);
                        } else {
                            console.error("Erro ao obter hor√°rios e UCs:", data.error);
                        }
                    })
                    .catch(error => console.error("Erro na requisi√ß√£o:", error));
            }


            function preencherTabelaHorarios(horarios) {
                const tabela = document.getElementById("horariosTableBody2");
                tabela.innerHTML = ""; // Limpa a tabela

                // Define os hor√°rios das 8h √†s 18h
                let startTime = new Date("1970-01-01T08:00:00");
                let endTime = new Date("1970-01-01T18:00:00");
                let currentTime = new Date(startTime);

                while (currentTime < endTime) {
                    const nextTime = new Date(currentTime);
                    nextTime.setMinutes(currentTime.getMinutes() + 60); // Incrementa 1 hora

                    // Formata o hor√°rio no formato "HH:mm"
                    const horaInicioFormatada = formatTime(currentTime);
                    const horaFimFormatada = formatTime(nextTime);

                    let row = `<tr><td>${horaInicioFormatada} - ${horaFimFormatada}</td>`;

                    // Para cada dia da semana, verifica se h√° uma disciplina correspondente
                    ["Segunda-feira", "Ter√ßa-feira", "Quarta-feira", "Quinta-feira", "Sexta-feira"].forEach(dia => {
                        const horario = horarios.find(h =>
                            h.dia_semana === dia &&
                            h.hora_inicio === `${horaInicioFormatada}:00` // Adapta para comparar com `HH:mm:ss`
                        );

                        if (horario) {
                            row += `<td class="droppable" data-dia="${dia}" data-hora-inicio="${horaInicioFormatada}" data-hora-fim="${horaFimFormatada}" data-disciplina="${horario.nome_uc}">
                    ${horario.nome_uc}
                </td>`;
                        } else {
                            row += `<td class="droppable" data-dia="${dia}" data-hora-inicio="${horaInicioFormatada}" data-hora-fim="${horaFimFormatada}"></td>`;
                        }
                    });

                    row += "</tr>";
                    tabela.innerHTML += row;

                    currentTime = nextTime; // Avan√ßa para o pr√≥ximo intervalo de tempo
                }
            }

            function formatTime(date) {
                return date.toTimeString().split(":").slice(0, 2).join(":"); // Retorna no formato "HH:mm"
            }

            function preencherDisciplinasDisponiveis(disciplinas) {
                const container = document.getElementById("disciplinasDisponiveis");
                container.innerHTML = ""; // Limpa as disciplinas
                disciplinas.forEach(disciplina => {
                    const div = document.createElement("div");
                    div.classList.add("draggable", "m-2", "p-2", "border", "bg-light");
                    div.textContent = disciplina.nome_disciplina;
                    div.setAttribute("draggable", "true");
                    div.setAttribute("data-disciplina", disciplina.nome_disciplina);
                    container.appendChild(div);
                });

                configurarDragAndDrop();
            }

            function formatTime(date) {
                return date.toTimeString().split(":").slice(0, 2).join(":");
            }


            function configurarDragAndDrop() {
                // Disciplinas arrast√°veis
                document.querySelectorAll(".draggable").forEach(item => {
                    item.addEventListener("dragstart", event => {
                        event.dataTransfer.setData("text/plain", event.target.dataset.disciplina);
                    });
                });

                // C√©lulas como √°reas de destino
                document.querySelectorAll(".droppable").forEach(cell => {
                    cell.addEventListener("dragover", event => event.preventDefault());

                    cell.addEventListener("drop", event => {
                        event.preventDefault();
                        const disciplina = event.dataTransfer.getData("text/plain");
                        event.target.textContent = disciplina;
                        event.target.setAttribute("data-disciplina", disciplina);
                    });
                });
            }


            function salvarHorarios() {
                const horarios = [];
                document.querySelectorAll(".droppable").forEach(cell => {
                    const disciplina = cell.getAttribute("data-disciplina");
                    if (disciplina) {
                        horarios.push({
                            dia: cell.getAttribute("data-dia"),
                            hora_inicio: cell.getAttribute("data-hora-inicio"),
                            hora_fim: cell.getAttribute("data-hora-fim"),
                            nome_uc: disciplina
                        });
                    }
                });

                fetch(`/salvar_horarios/${idTurno}/`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ horarios })
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            console.log("Hor√°rios salvos com sucesso!");
                            // Atualize a UI ou feche o modal
                        } else {
                            console.error("Erro ao salvar hor√°rios:", data.error);
                        }
                    })
                    .catch(error => console.error("Erro na requisi√ß√£o:", error));
            }


        </script>